# SSL Сертификаты для MetaRep

## Автоматическая система самоподписанных SSL сертификатов

Проект теперь включает автоматическую генерацию и обновление самоподписанных SSL сертификатов.

### Как это работает

1. **SSL-менеджер контейнер** - отдельный контейнер на Alpine Linux который:
   - Генерирует самоподписанные SSL сертификаты при первом запуске
   - Проверяет действительность сертификатов каждый день в 3:00
   - Автоматически обновляет сертификаты за 30 дней до истечения
   - Перезагружает nginx после обновления сертификатов

2. **Shared volume** - сертификаты хранятся в Docker volume `ssl-certs` который:
   - Доступен обоим контейнерам (ssl-manager и nginx)
   - Сохраняется между перезапусками
   - Автоматически создается при первом запуске

### Запуск продакшн среды

```bash
# Сборка и запуск всех сервисов
docker-compose -f docker-compose.prod.yml up -d

# Проверка статуса
docker-compose -f docker-compose.prod.yml ps

# Просмотр логов SSL менеджера
docker-compose -f docker-compose.prod.yml logs ssl-manager

# Проверка сертификата
docker exec metarep-ssl openssl x509 -in /etc/nginx/ssl/cert.pem -text -noout
```

### Особенности сертификата

- **Действителен**: 1 год с момента генерации
- **Домены**: metarep.local, localhost, *.metarep.local
- **IP адреса**: 127.0.0.1, ::1
- **Автообновление**: за 30 дней до истечения

### Доступ к приложению

После запуска приложение будет доступно по:
- **HTTPS**: https://localhost (основной)
- **HTTP**: http://localhost (редирект на HTTPS)

### Безопасность

⚠️ **Внимание**: Это самоподписанные сертификаты. Браузер будет показывать предупреждение о безопасности.

Для продакшн использования рекомендуется:
1. Использовать Let's Encrypt для реальных сертификатов
2. Настроить правильные доменные имена
3. Использовать CA-подписанные сертификаты

### Мониторинг

- Логи обновления: `/var/log/ssl-renew.log` в контейнере
- Health check: проверка существования сертификата каждые 60 секунд
- Автоматический перезапуск при сбоях

### Настройка

Если нужно изменить параметры сертификата, отредактируйте `scripts/generate-ssl.sh`:

```bash
# Срок действия (дни)
openssl req -new -x509 -key "$KEY_FILE" -out "$CERT_FILE" -days 365

# Домены и IP адреса в секции [alt_names]
``` 